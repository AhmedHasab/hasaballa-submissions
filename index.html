<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <title>Hasaballa AI ‚Äì Developer Questionnaire</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <!-- EmailJS SDK (ŸÖÿ¨ÿßŸÜŸä) -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

  <style>
    body{font-family:Arial,Helvetica,sans-serif;margin:20px;line-height:1.6;background:#f8f9fa;color:#111}
    h1,h2,h3{margin:10px 0;text-align:center}
    .container{max-width:1000px;margin:0 auto}
    .card{background:#fff;border:1px solid #e3e6e9;border-radius:10px;padding:18px;margin:14px 0;box-shadow:0 1px 2px rgba(0,0,0,.04)}
    label{font-weight:bold;display:block;margin-top:14px}
    textarea,input,select{width:100%;padding:10px;margin-top:6px;border:1px solid #d0d7de;border-radius:8px;background:#fff}
    .radio-group{display:flex;gap:18px;margin:10px 0;flex-wrap:wrap}
    .btn{display:inline-block;margin-top:16px;padding:12px 18px;border:none;border-radius:10px;background:#0d6efd;color:#fff;font-weight:600;cursor:pointer}
    .btn:hover{background:#0b5ed7}
    small.req{color:#c00;font-weight:600}
    ul{margin-top:6px}
    .muted{color:#6c757d;font-size:.95em}
    .pill{display:inline-block;padding:4px 8px;border-radius:999px;background:#eef1f4;margin:2px 4px;font-size:.9em}
    .table{width:100%;border-collapse:collapse;margin-top:8px}
    .table th,.table td{border:1px solid #e3e6e9;padding:8px}
    .table th{background:#f1f3f5}
    .note{background:#fff3cd;border:1px solid #ffe69c;color:#664d03;padding:10px;border-radius:8px}
    .success{background:#e9fbe9;border:1px solid #c6f6c6;color:#0f5132;padding:10px;border-radius:8px}
    .danger{background:#fde2e1;border:1px solid #f5c2c7;color:#842029;padding:10px;border-radius:8px}
    .flex-between{display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap}
    code{background:#eef1f4;padding:2px 6px;border-radius:6px}
    .cond-block{border:1px dashed #d0d7de;border-radius:10px;padding:12px;margin-top:12px;background:#fcfcfd}
  </style>
</head>
<body>
<div class="container">

  <div class="card">
    <h1>Full Offline AI Media Generation Platform ‚Äì Hasaballa AI</h1>
    <h2>üõ†Ô∏è Platform: Hasaballa AI ‚Äì Description & How it Works</h2>
    <p class="muted">The Hasaballa AI platform will run fully offline ‚Äî even if it‚Äôs 200 GB in size.</p>

    <h2>üéØ Platform Goals</h2>
    <p>To produce unlimited videos at high speed / top quality for Arab creators ‚Äî without any subscriptions, APIs, or internet connection ‚Äî matching (at minimum) the quality shown in:</p>
    <ul>
      <li><a href="https://tinyurl.com/4py6ntv5" target="_blank" rel="noopener">Link 1</a></li>
      <li><a href="https://tinyurl.com/457h6pxb" target="_blank" rel="noopener">Link 2</a></li>
      <li><a href="https://tinyurl.com/kye234sk" target="_blank" rel="noopener">Link 3</a></li>
      <li><a href="https://tinyurl.com/s65thcdc" target="_blank" rel="noopener">Link 4</a></li>
      <li><a href="https://tinyurl.com/mjb7cw8v" target="_blank" rel="noopener">Link 5</a></li>
      <li><a href="https://tinyurl.com/r6b2ndn9" target="_blank" rel="noopener">Link 6</a></li>
    </ul>

    <h2>üìÇ Documentation</h2>
    <p>A full detailed document of the platform (all tasks, sub-tasks, and requirements) will be provided to the selected developer/team.</p>
  </div>

  <!-- ======== BASIC INFO OUTSIDE FORM (but tied via form="devForm") ======== -->
  <label>Your Name <small class="req">*</small></label>
  <input type="text" name="name" required form="devForm">

  <label>Company / Team <small class="req">*</small></label>
  <input type="text" name="company" required form="devForm">

  <label>Platform</label>
  <select name="platform" form="devForm">
    <option value="">-- Select --</option>
    <option value="Freelancer">Freelancer</option>
    <option value="Guru">Guru</option>
    <option value="Upwork">Upwork</option>
  </select>

  <!-- ======== FORM START ======== -->
  <form class="card" id="devForm">
    <h3>üìú General Conditions (Required)</h3>

    <!-- 1..16 (ÿßŸÑÿ±ÿßÿØŸäŸà ŸÅŸàŸÇ - ÿßŸÑÿ™ÿπŸÑŸäŸÇ ÿ™ÿ≠ÿ™ ÿßÿÆÿ™Ÿäÿßÿ±Ÿä) -->
    <div class="cond-block">
      <label>1) Scope Integration <small class="req">*</small></label>
      <p class="muted">All milestones must be fully compatible and interconnected. Tasks 1 to 3 are mandatory in every milestone.</p>
      <div class="radio-group">
        <label><input type="radio" name="cond1_agree" value="Agree" required> Agree</label>
        <label><input type="radio" name="cond1_agree" value="Disagree" required> Disagree</label>
      </div>
      <label>Add comment (optional)</label><textarea name="cond1_comment"></textarea>
    </div>

    <div class="cond-block">
      <label>2) Reference Quality Enforcement <small class="req">*</small></label>
      <p class="muted">Each milestone must deliver output equal to or better than the reference videos. Lower quality will be rejected; developer must revise at no extra cost.</p>
      <div class="radio-group">
        <label><input type="radio" name="cond2_agree" value="Agree" required> Agree</label>
        <label><input type="radio" name="cond2_agree" value="Disagree" required> Disagree</label>
      </div>
      <label>Add comment (optional)</label><textarea name="cond2_comment"></textarea>
    </div>

    <div class="cond-block">
      <label>3) Client Approval Requirement <small class="req">*</small></label>
      <p class="muted">No milestone is approved without client confirmation based on quality and completeness.</p>
      <div class="radio-group">
        <label><input type="radio" name="cond3_agree" value="Agree" required> Agree</label>
        <label><input type="radio" name="cond3_agree" value="Disagree" required> Disagree</label>
      </div>
      <label>Add comment (optional)</label><textarea name="cond3_comment"></textarea>
    </div>

    <div class="cond-block">
      <label>4) Unlimited Revisions Within Scope <small class="req">*</small></label>
      <p class="muted">Unlimited revisions within scope until desired quality is achieved. Milestone must meet all functional & visual requirements.</p>
      <div class="radio-group">
        <label><input type="radio" name="cond4_agree" value="Agree" required> Agree</label>
        <label><input type="radio" name="cond4_agree" value="Disagree" required> Disagree</label>
      </div>
      <label>Add comment (optional)</label><textarea name="cond4_comment"></textarea>
    </div>

    <div class="cond-block">
      <label>5) Platform Must Be 100% Offline <small class="req">*</small></label>
      <p class="muted">Runs entirely offline on client device; no paid APIs, cloud, or online services.</p>
      <div class="radio-group">
        <label><input type="radio" name="cond5_agree" value="Agree" required> Agree</label>
        <label><input type="radio" name="cond5_agree" value="Disagree" required> Disagree</label>
      </div>
      <label>Add comment (optional)</label><textarea name="cond5_comment"></textarea>
    </div>

    <div class="cond-block">
      <label>6) Technology Requirements <small class="req">*</small></label>
      <p class="muted">Build with PyTorch, FFmpeg, (optional) OpenCV, Whisper.cpp, CUDA (offline only). No 3rd-party APIs/cloud/subscriptions.</p>
      <div class="radio-group">
        <label><input type="radio" name="cond6_agree" value="Agree" required> Agree</label>
        <label><input type="radio" name="cond6_agree" value="Disagree" required> Disagree</label>
      </div>
      <label>Add comment (optional)</label><textarea name="cond6_comment"></textarea>
    </div>

    <div class="cond-block">
      <label>7) Local Device Performance Guarantee <small class="req">*</small></label>
      <p class="muted">Must run smoothly on RTX 5090, 64GB RAM, 4TB SSD without lag/crashes.</p>
      <div class="radio-group">
        <label><input type="radio" name="cond7_agree" value="Agree" required> Agree</label>
        <label><input type="radio" name="cond7_agree" value="Disagree" required> Disagree</label>
      </div>
      <label>Add comment (optional)</label><textarea name="cond7_comment"></textarea>
    </div>

    <div class="cond-block">
      <label>8) IP Ownership <small class="req">*</small></label>
      <p class="muted">Client retains 100% IP on code/models/assets/outputs after full payment. No reuse/share/sell.</p>
      <div class="radio-group">
        <label><input type="radio" name="cond8_agree" value="Agree" required> Agree</label>
        <label><input type="radio" name="cond8_agree" value="Disagree" required> Disagree</label>
      </div>
      <label>Add comment (optional)</label><textarea name="cond8_comment"></textarea>
    </div>

    <div class="cond-block">
      <label>9) NDA <small class="req">*</small></label>
      <p class="muted">No disclosure/replication during or after contract.</p>
      <div class="radio-group">
        <label><input type="radio" name="cond9_agree" value="Agree" required> Agree</label>
        <label><input type="radio" name="cond9_agree" value="Disagree" required> Disagree</label>
      </div>
      <label>Add comment (optional)</label><textarea name="cond9_comment"></textarea>
    </div>

    <div class="cond-block">
      <label>10) Backup Requirement <small class="req">*</small></label>
      <p class="muted">At each milestone end, provide a local backup of code/models/settings.</p>
      <div class="radio-group">
        <label><input type="radio" name="cond10_agree" value="Agree" required> Agree</label>
        <label><input type="radio" name="cond10_agree" value="Disagree" required> Disagree</label>
      </div>
      <label>Add comment (optional)</label><textarea name="cond10_comment"></textarea>
    </div>

    <div class="cond-block">
      <label>11) Post-Delivery Support <small class="req">*</small></label>
      <p class="muted">2 weeks free support after final milestone for minor bugs.</p>
      <div class="radio-group">
        <label><input type="radio" name="cond11_agree" value="Agree" required> Agree</label>
        <label><input type="radio" name="cond11_agree" value="Disagree" required> Disagree</label>
      </div>
      <label>Add comment (optional)</label><textarea name="cond11_comment"></textarea>
    </div>

    <div class="cond-block">
      <label>12) Custom Development Requirement <small class="req">*</small></label>
      <p class="muted">All components must be custom-built; no commercial/AIaaS/cloud/licensed services.</p>
      <div class="radio-group">
        <label><input type="radio" name="cond12_agree" value="Agree" required> Agree</label>
        <label><input type="radio" name="cond12_agree" value="Disagree" required> Disagree</label>
      </div>
      <label>Add comment (optional)</label><textarea name="cond12_comment"></textarea>
    </div>

    <div class="cond-block">
      <label>13) Termination for Quality Breach <small class="req">*</small></label>
      <p class="muted">If minimum quality not met after multiple revisions, client may cancel without penalty; milestone is rejected.</p>
      <div class="radio-group">
        <label><input type="radio" name="cond13_agree" value="Agree" required> Agree</label>
        <label><input type="radio" name="cond13_agree" value="Disagree" required> Disagree</label>
      </div>
      <label>Add comment (optional)</label><textarea name="cond13_comment"></textarea>
    </div>

    <div class="cond-block">
      <label>14) Milestone Delivery & Integration <small class="req">*</small></label>
      <p class="muted">Delivered in phases, but final delivery must be one integrated system. Standalone tools not accepted.</p>
      <div class="radio-group">
        <label><input type="radio" name="cond14_agree" value="Agree" required> Agree</label>
        <label><input type="radio" name="cond14_agree" value="Disagree" required> Disagree</label>
      </div>
      <label>Add comment (optional)</label><textarea name="cond14_comment"></textarea>
    </div>

    <div class="cond-block">
      <label>15) Payment & Retention <small class="req">*</small></label>
      <p class="muted">50% on milestone approval; 50% retained until fully integrated platform is delivered and tested on client device.</p>
      <div class="radio-group">
        <label><input type="radio" name="cond15_agree" value="Agree" required> Agree</label>
        <label><input type="radio" name="cond15_agree" value="Disagree" required> Disagree</label>
      </div>
      <label>Add comment (optional)</label><textarea name="cond15_comment"></textarea>
    </div>

    <div class="cond-block">
      <label>16) Risk Management <small class="req">*</small></label>
      <p class="muted">If the final integrated platform is not delivered, client may retain pending balances and keep delivered code without further payment.</p>
      <div class="radio-group">
        <label><input type="radio" name="cond16_agree" value="Agree" required> Agree</label>
        <label><input type="radio" name="cond16_agree" value="Disagree" required> Disagree</label>
      </div>
      <label>Add comment (optional)</label><textarea name="cond16_comment"></textarea>
    </div>

    <!-- ================= Developer Questionnaire (Technical) ================= -->
    <div class="card">
      <h3>üìù Developer Questionnaire (Technical)</h3>

      <label>Are you a team? <small class="req">*</small></label>
      <div class="radio-group"><label><input type="radio" name="is_team" value="Yes" required> Team</label><label><input type="radio" name="is_team" value="No" required> Solo</label></div>

      <label>1- If Team: list members & roles <small class="req">*</small></label><textarea name="team_details" required></textarea>
      <label>2- Have you worked with AI tools before? (brief) <small class="req">*</small></label><textarea name="ai_experience" required></textarea>
      <label>3- Which AI tools do you have strong experience with? <small class="req">*</small></label><textarea name="ai_tools" required></textarea>
      <label>4- Tools for ultra-realistic image generation...? <small class="req">*</small></label><textarea name="tools_imagegen" required></textarea>
      <label>5- Tools to ensure 100% correct Arabic text? <small class="req">*</small></label><textarea name="tools_arabictext" required></textarea>
      <label>6- Tools for identity lock? <small class="req">*</small></label><textarea name="tools_identity" required></textarea>
      <label>7- Tools for audio enhancement? <small class="req">*</small></label><textarea name="tools_audioenhance" required></textarea>
      <label>8- Tools for voice cloning & generation? <small class="req">*</small></label><textarea name="tools_voiceclone" required></textarea>
      <label>9- Tools for Arabic dialects? <small class="req">*</small></label><textarea name="tools_dialects" required></textarea>
      <label>10- Tools for singing voice generation? <small class="req">*</small></label><textarea name="tools_singing" required></textarea>
      <label>11- Tools for integrated sound library? <small class="req">*</small></label><textarea name="tools_soundlib" required></textarea>
      <label>12- Tools for cinematic image animation? <small class="req">*</small></label><textarea name="tools_animation" required></textarea>
      <label>13- Worked with SkyReels V2? Opinion?</label><textarea name="tools_skyreels"></textarea>
      <label>14- Tools for lip-sync? <small class="req">*</small></label><textarea name="tools_lipsync" required></textarea>
      <label>15- Tools for Chat Window analysis/orchestration? <small class="req">*</small></label><textarea name="tools_chatwindow" required></textarea>
      <label>16- Tools to integrate all modules? <small class="req">*</small></label><textarea name="tools_integration" required></textarea>
      <label>17- If a chosen AI tool fails, how will you replace/adapt? <small class="req">*</small></label><textarea name="tools_flexibility" required></textarea>

      <!-- ‚ú® ÿßŸÑÿ≥ÿ§ÿßŸÑ ÿßŸÑÿ¨ÿØŸäÿØ ÿ±ŸÇŸÖ 18 -->
      <label>18- What tools/pipeline will you use to fully auto-produce a 7-minute video in ‚â§45 minutes (and a 15-minute video in ‚â§90 minutes) starting from the Chat Window (deep scenario analysis ~15 scenes / ~15k chars) using the Smart Director (Auto) ‚Äî including all images, voices, visual/audio backgrounds? <small class="req">*</small></label>
      <textarea name="tools_auto_pipeline" required></textarea>

      <label>19- Are you ready to deliver 100% quality? <small class="req">*</small></label>
      <div class="radio-group"><label><input type="radio" name="deliver_quality" value="Yes" required> Yes</label><label><input type="radio" name="deliver_quality" value="No" required> No</label></div>

      <label>20- Will your outputs match reference videos‚Äô quality? <small class="req">*</small></label>
      <div class="radio-group"><label><input type="radio" name="match_quality" value="Yes" required> Yes</label><label><input type="radio" name="match_quality" value="No" required> No</label></div>
    </div>

    <!-- Basic Confirmation -->
    <div class="card">
      <h3>‚ùì Basic Confirmation Questions</h3>

      <label>21- Have you read all the main tasks... and visited the reference video links? <small class="req">*</small></label>
      <div class="radio-group">
        <label><input type="radio" name="read_refs" value="Yes" required> Yes</label>
        <label><input type="radio" name="read_refs" value="No" required> No</label>
      </div>
      <label>22- Add a comment regarding this question (optional)</label>
      <textarea name="read_refs_comment"></textarea>

      <label>23- Are you absolutely confident... about delivering the required quality at 100%? <small class="req">*</small></label>
      <div class="radio-group">
        <label><input type="radio" name="confident_100" value="Yes" required> Yes</label>
        <label><input type="radio" name="confident_100" value="No" required> No</label>
      </div>

      <label>24- Will your outputs match at least the quality of the reference videos? <small class="req">*</small></label>
      <div class="radio-group">
        <label><input type="radio" name="match_reference_quality" value="Yes" required> Yes</label>
        <label><input type="radio" name="match_reference_quality" value="No" required> No</label>
      </div>
    </div>

    <!-- Additional Required -->
    <div class="card">
      <h3>‚ûï Additional Required Questions</h3>
      <label>25- Quality Metrics ‚Äì KPIs & checks <small class="req">*</small></label><textarea name="quality_metrics" required></textarea>
      <label>26- Training / Fine-tuning Strategy <small class="req">*</small></label><textarea name="training_strategy" required></textarea>
      <label>27- Comprehensive Platform Test Plan <small class="req">*</small></label><textarea name="test_plan" required></textarea>
    </div>

    <button class="btn" type="submit">Submit Application</button>
    <div id="statusBox" style="margin-top:10px;"></div>
  </form>
  <!-- ======== FORM END ======== -->

</div>

<script>
/* ====================== EmailJS CONFIG ====================== */
/* ÿ®ÿØŸëŸÑ ÿßŸÑŸÇŸäŸÖ ÿßŸÑÿ´ŸÑÿßÿ´ÿ© ÿØŸàŸÑ ŸÖŸÜ ÿ≠ÿ≥ÿßÿ®ŸÉ ŸÅŸä EmailJS */
const EMAILJS_PUBLIC_KEY  = "YOUR_PUBLIC_KEY";
const EMAILJS_SERVICE_ID  = "YOUR_SERVICE_ID";
const EMAILJS_TEMPLATE_ID = "YOUR_TEMPLATE_ID";
const EMAIL_TO = "namozg50@gmail.com";

emailjs.init({ publicKey: EMAILJS_PUBLIC_KEY });

/* =================== Scoring / Analysis =================== */
const SCORE_WEIGHTS = {
  imagegen:{good:["stable diffusion","sdxl","sd3","flux","comfyui","controlnet","ip-adapter","instantid","lora","kohya","roop","reactor"],bad:["midjourney","dalle","api","cloud"]},
  arabicText:{good:["arabic","harakat","ocr","ligature","font shaping","text rendering","pangram","inpaint","controlnet tile"],bad:["api","cloud"]},
  identity:{good:["instantid","ip-adapter faceid","reactor","roop","faceid","seed lock","embeddings"],bad:["api","cloud"]},
  voiceEnhance:{good:["ffmpeg","sox","demucs","rx","rnnoise","dns","spleeter","librosa"],bad:["api","cloud"]},
  voiceClone:{good:["tacotron","vits","coqui","so-vits","rvc","fish-speech","xtts","tortoise"],bad:["api","cloud"]},
  dialects:{good:["arabic dialect","msa","egyptian","gulf","levantine","maghrebi","sudanese","yemeni","phoneme","grapheme","g2p","ipa"],bad:["api","cloud"]},
  singing:{good:["sovits-svc","rvc","diff-svc","pitch tracking","f0","mel spectrogram"],bad:["api","cloud"]},
  soundlib:{good:["ffmpeg","wavpack","flac","24bit","48khz","audio layering","loudness","ebu r128"],bad:["api","cloud"]},
  animation:{good:["skyreels","skyr eels","animate diff","ebsynth","dreamtalk","sadtalker","wav2lip","densepose","optical flow","first order motion"],bad:["api","cloud"]},
  lipsync:{good:["wav2lip","sadtalker","syncnet","phoneme align","ctc","tts alignment"],bad:["api","cloud"]},
  chatwindow:{good:["mistral","mixtral","llama","llama.cpp","ollama","gguf","router","parser","seeded planning"],bad:["api","cloud"]},
  integration:{good:["pytorch","cuda","node","python","grpc","message bus","ffmpeg","opencv","async","pipeline","timeline"],bad:["api","cloud"]}
};
function norm(t){return (t||"").toLowerCase();}
function analyzeSubmission(fields){
  function scoreField(text,map){let s=0,hg=[],hb=[];const n=norm(text||"");map.good.forEach(k=>{if(n.includes(k)){s+=10;hg.push(k);}});map.bad.forEach(k=>{if(n.includes(k)){s-=8;hb.push(k);}});return{s,hg,hb};}
  const buckets={
    imagegen:scoreField(fields.tools_imagegen,SCORE_WEIGHTS.imagegen),
    arabicText:scoreField(fields.tools_arabictext,SCORE_WEIGHTS.arabicText),
    identity:scoreField(fields.tools_identity,SCORE_WEIGHTS.identity),
    voiceEnhance:scoreField(fields.tools_audioenhance,SCORE_WEIGHTS.voiceEnhance),
    voiceClone:scoreField(fields.tools_voiceclone,SCORE_WEIGHTS.voiceClone),
    dialects:scoreField(fields.tools_dialects,SCORE_WEIGHTS.dialects),
    singing:scoreField(fields.tools_singing,SCORE_WEIGHTS.singing),
    soundlib:scoreField(fields.tools_soundlib,SCORE_WEIGHTS.soundlib),
    animation:scoreField(fields.tools_animation,SCORE_WEIGHTS.animation),
    lipsync:scoreField(fields.tools_lipsync,SCORE_WEIGHTS.lipsync),
    chatwindow:scoreField(fields.tools_chatwindow,SCORE_WEIGHTS.chatwindow),
    integration:scoreField(fields.tools_integration,SCORE_WEIGHTS.integration)
  };
  let total=0, positives=[], negatives=[];
  Object.values(buckets).forEach(v=>{total+=v.s;positives=positives.concat(v.hg);negatives=negatives.concat(v.hb);});
  const qLen = norm(fields.quality_metrics).length + norm(fields.training_strategy).length + norm(fields.test_plan).length;
  total += Math.min(30, Math.floor(qLen/200));
  const score=Math.max(0, Math.min(100, Math.round((total/220)*100)));
  const strengths=[], weaknesses=[];
  if(positives.some(x=>["sdxl","flux","controlnet","ip-adapter","instantid","lora"].includes(x))) strengths.push("Strong image generation/tooling");
  if(positives.some(x=>["instantid","faceid","roop","reactor"].includes(x))) strengths.push("Identity stability addressed");
  if(positives.some(x=>["wav2lip","sadtalker","syncnet"].includes(x))) strengths.push("Clear lip-sync approach");
  if(positives.some(x=>["tacotron","vits","coqui","rvc","xtts"].includes(x))) strengths.push("Voice cloning/generation stack present");
  if(positives.some(x=>["mistral","mixtral","llama","ollama","gguf"].includes(x))) strengths.push("Offline LLM/router for Chat Window");
  if(positives.some(x=>["pytorch","ffmpeg","cuda","opencv"].includes(x))) strengths.push("Solid integration stack");
  if(qLen<400) weaknesses.push("Quality/Training/Test answers need more depth.");
  const recommendation = score>=85? "Highly Recommended" : score>=70? "Recommended" : score>=55? "Borderline" : "Not Recommended";
  const isBestTools = (weaknesses.length===0 && score>=75) ? "Yes" : "No";
  return {score,strengths,weaknesses,recommendation,isBestTools};
}

/* ============ ÿ®ŸÜÿßÿ° ÿ•ŸäŸÖŸäŸÑ HTML ŸÖŸÜÿ≥ŸëŸÇ (ÿ¨ÿØŸàŸÑ Ÿàÿ£ŸÑŸàÿßŸÜ) ============ */
function buildEmailHTML(payload){
  const a = payload.analysis || {};
  const esc = s => String(s||"").replace(/[<&>]/g, c => ({'<':'&lt;','>':'&gt;','&':'&amp;'}[c]));
  const kv = (k) => esc(payload[k]);

  const keyAnswers = [
    ["Deliver 100% quality", payload.deliver_quality],
    ["Match reference quality", payload.match_quality],
    ["Read refs", payload.read_refs],
    ["Confident 100%", payload.confident_100],
    ["Match reference (confirm)", payload.match_reference_quality],
  ];

  // ÿßÿ¨ÿßÿ®ÿßÿ™ ŸÖÿÆÿ™ÿßÿ±ÿ© ŸÖŸáŸÖÿ© ŸÖÿÆÿ™ÿµÿ±ÿ©
  const highlights = [
    ["Image Gen", payload.tools_imagegen],
    ["Identity Lock", payload.tools_identity],
    ["Lip-Sync", payload.tools_lipsync],
    ["Voice Clone", payload.tools_voiceclone],
    ["Integration", payload.tools_integration],
    ["Auto Pipeline (Q18)", payload.tools_auto_pipeline]
  ];

  return `
  <div style="font-family:Arial,Helvetica,sans-serif;background:#f6f9fc;padding:16px">
    <div style="max-width:860px;margin:auto;background:#ffffff;border:1px solid #e6e9ef;border-radius:12px;overflow:hidden">
      <div style="background:#0d6efd;color:#fff;padding:16px 20px">
        <h2 style="margin:0;font-size:20px">New Hasaballa AI Developer Submission</h2>
        <div style="opacity:.9">Created at: ${new Date(payload.created_at||Date.now()).toUTCString()}</div>
      </div>

      <div style="padding:18px 20px">
        <h3 style="margin:0 0 8px 0">Applicant</h3>
        <table width="100%" cellpadding="0" cellspacing="0" style="border-collapse:collapse">
          <tr>
            <td style="padding:8px;border:1px solid #eef2f7;background:#f8fbff;width:30%"><strong>Name</strong></td>
            <td style="padding:8px;border:1px solid #eef2f7">${esc(payload.name)}</td>
          </tr>
          <tr>
            <td style="padding:8px;border:1px solid #eef2f7;background:#f8fbff"><strong>Company</strong></td>
            <td style="padding:8px;border:1px solid #eef2f7">${esc(payload.company)}</td>
          </tr>
          <tr>
            <td style="padding:8px;border:1px solid #eef2f7;background:#f8fbff"><strong>Platform</strong></td>
            <td style="padding:8px;border:1px solid #eef2f7">${esc(payload.platform||"-")}</td>
          </tr>
        </table>

        <h3 style="margin:18px 0 8px 0">Recommendation</h3>
        <table width="100%" cellpadding="0" cellspacing="0" style="border-collapse:collapse">
          <tr>
            <td style="padding:8px;border:1px solid #eef2f7;background:#ecfff1"><strong>Score</strong></td>
            <td style="padding:8px;border:1px solid #eef2f7"><strong style="color:#0a7a3b">${a.score||0}%</strong></td>
          </tr>
          <tr>
            <td style="padding:8px;border:1px solid #eef2f7;background:#ecfff1"><strong>Recommendation</strong></td>
            <td style="padding:8px;border:1px solid #eef2f7">${esc(a.recommendation||"-")}</td>
          </tr>
          <tr>
            <td style="padding:8px;border:1px solid #eef2f7;background:#ecfff1"><strong>Best Tools?</strong></td>
            <td style="padding:8px;border:1px solid #eef2f7">${esc(a.isBestTools||"-")}</td>
          </tr>
        </table>

        <h3 style="margin:18px 0 8px 0">Key Answers (Radios)</h3>
        <table width="100%" cellpadding="0" cellspacing="0" style="border-collapse:collapse">
          ${keyAnswers.map(([k,v])=>`
            <tr>
              <td style="padding:8px;border:1px solid #eef2f7;background:#fffaf3;width:40%"><strong>${esc(k)}</strong></td>
              <td style="padding:8px;border:1px solid #eef2f7">${esc(v||"-")}</td>
            </tr>
          `).join("")}
        </table>

        <h3 style="margin:18px 0 8px 0">Highlights</h3>
        <table width="100%" cellpadding="0" cellspacing="0" style="border-collapse:collapse">
          ${highlights.map(([k,v])=>`
            <tr>
              <td style="padding:8px;border:1px solid #eef2f7;background:#f3f9ff;width:40%"><strong>${esc(k)}</strong></td>
              <td style="padding:8px;border:1px solid #eef2f7;white-space:pre-wrap">${esc(v||"-")}</td>
            </tr>
          `).join("")}
        </table>

        ${(a.strengths && a.strengths.length)?`
          <h3 style="margin:18px 0 8px 0">Strengths</h3>
          <ul style="margin:0 0 10px 18px">${a.strengths.map(s=>`<li>${esc(s)}</li>`).join("")}</ul>
        `:""}

        ${(a.weaknesses && a.weaknesses.length)?`
          <h3 style="margin:18px 0 8px 0">Weaknesses</h3>
          <ul style="margin:0 0 10px 18px">${a.weaknesses.map(s=>`<li>${esc(s)}</li>`).join("")}</ul>
        `:""}

        <details style="margin-top:14px">
          <summary style="cursor:pointer;color:#0d6efd">Show full JSON (debug)</summary>
          <pre style="white-space:pre-wrap;background:#f6f8fa;border:1px solid #e1e4e8;border-radius:8px;padding:10px;margin-top:8px">${esc(JSON.stringify(payload,null,2))}</pre>
        </details>
      </div>

      <div style="background:#0d6efd1a;color:#0d6efd;padding:12px 20px">
        Hasaballa AI ‚Äì Offline Media Platform
      </div>
    </div>
  </div>
  `;
}

/* =================== Submit Handler =================== */
const statusBox=document.getElementById("statusBox");
document.getElementById("devForm").addEventListener("submit", async (e)=>{
  e.preventDefault();
  statusBox.className=""; statusBox.textContent="";

  // ÿ¨ŸÖÿπ ŸÉŸÑ ÿßŸÑÿ≠ŸÇŸàŸÑ
  const fd = new FormData(e.target);
  const payload = {};
  fd.forEach((v,k)=>payload[k]=String(v).trim());

  // ÿ™ÿ≠ŸÑŸäŸÑ + ŸàŸÇÿ™
  payload.analysis   = analyzeSubmission(payload);
  payload.created_at = new Date().toISOString();

  // ÿ®ŸÜÿßÿ° HTML ŸÖŸÜÿ≥ŸëŸÇ ŸÑŸÑÿ•ŸäŸÖŸäŸÑ
  const message_html = buildEmailHTML(payload);
  const subject = "New Hasaballa AI Developer Submission";

  try{
    await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, {
      to_email: EMAIL_TO,
      subject,
      message_html // ŸÅŸä ŸÇÿßŸÑÿ® EmailJS ÿßÿ≥ÿ™ÿÆÿØŸÖ {{{message_html}}}
    });
    statusBox.className="success";
    statusBox.textContent="‚úÖ Email sent successfully.";
  }catch(err){
    statusBox.className="danger";
    statusBox.textContent="‚ùå Email send failed: " + (err?.text || err?.message || String(err));
  }

  // ÿ≠ŸÅÿ∏ ŸÖÿ≠ŸÑŸä ŸÉŸÜÿ≥ÿÆÿ© ÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ©
  const local=JSON.parse(localStorage.getItem("hasaballa_submissions")||"[]");
  local.push(payload);
  localStorage.setItem("hasaballa_submissions",JSON.stringify(local));
});
</script>
</body>
</html>
